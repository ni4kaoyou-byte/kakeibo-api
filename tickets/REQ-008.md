# REQ-008 Definition of Done定義

- Status: Done
- Priority: Must
- Depends On: REQ-007

## Goal

PRを完了とみなす共通基準を定義する。

## Definition of Done (Project Standard)

### 1. Requirement Traceability

- 対象チケットID（例: `REQ-xxx`, `IMP-xxx`）がPRに記載されていること
- 実装内容がチケットの受け入れ条件に対応していること

### 2. TDD Completion

- `Red -> Green -> Refactor` の証跡をPR説明に記載
- バグ修正時は再現テストが先に追加されていること
- 追加/修正したテストがすべて成功していること

### 3. Test Gate

- Unit / Integration / API テストが対象範囲で実行済み
- Security観点テスト（401/403）が含まれていること
- 失敗テスト・flakyテストが残っていないこと

### 4. Review Gate

- `docs/review-checklist.md` の該当項目を自己点検済み
- レビュー指摘に対して対応または理由付きで保留判断済み
- 依存方向（layered + DDD lite）違反がないこと

### 5. API / Contract Gate

- API変更時は `docs/openapi-draft.yaml` を更新済み
- エラーレスポンス形式（`code/message/details`）が統一されていること
- CQRS-lite の Command/Query 分離規約を守っていること

### 6. Data / Migration Gate

- DB変更時は Flyway migration を追加済み
- migration が再実行可能で、ローカル適用確認済み
- `ddl-auto` に依存した本番前提変更がないこと

### 7. Security / Ops Gate

- 機密情報をコード・ログ・PRに含めていないこと
- 監査対象操作のログ要件を満たしていること
- 監視やアラートに影響する変更は関連ドキュメントを更新済み

### 8. Documentation Gate

- 変更に応じて関連ドキュメントを更新済み
  - `tickets/*`
  - `docs/openapi-draft.yaml`
  - `docs/er-diagram.md`（必要時）
  - `docs/definition-of-done.md`（本基準）

### 9. Merge Decision

- 上記ゲートがすべて満たされた場合のみ `Done` と判定する
- 未充足項目がある場合は、例外申請（理由・影響・期限）をPRに明記する

## Deliverable

- DoD基準書: `docs/definition-of-done.md`

## Acceptance Criteria

- [x] テスト完了条件が定義されている
- [x] `docs/review-checklist.md` を使ったレビュー条件が定義されている
- [x] ドキュメント更新条件が定義されている
- [x] マージ可否を判定できるチェックリストになっている
